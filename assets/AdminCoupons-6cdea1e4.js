import{M as $}from"./modal-01fe16ee.js";import{_ as b,o as l,c as d,a as o,d as C,u as r,D as c,E as m,G as w,r as f,F as k,t as x,b as M}from"./index-46c73ccd.js";import"./selector-engine-8f1af728.js";const D={props:{coupon:{type:Object,default(){return{}}}},data(){return{modal:{}}},methods:{showModal(){this.modal.show()},hideModal(){this.modal.hide()}},mounted(){this.modal=new $(this.$refs.delCouponModal)}},A={id:"delOrderModal",ref:"delCouponModal",class:"modal fade",tabindex:"-1","aria-labelledby":"delOrderModalLabel","aria-hidden":"true"},V={class:"modal-dialog"},N={class:"modal-content border-0"},P=o("div",{class:"modal-header bg-danger text-white"},[o("h5",{id:"delOrderModalLabel",class:"modal-title"},[o("span",null,"刪除訂單")]),o("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),T={class:"modal-body"},U={class:"text-danger"},E={class:"modal-footer"},L=o("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function O(t,e,i,p,s,a){return l(),d("div",A,[o("div",V,[o("div",N,[P,o("div",T,[C(" 是否刪除 "),o("strong",U,r(i.coupon.title),1),C(" 優惠券(刪除後將無法恢復)。 ")]),o("div",E,[L,o("button",{type:"button",class:"btn btn-danger",onClick:e[0]||(e[0]=n=>t.$emit("delCoupon"))}," 確認刪除 ")])])])],512)}const B=b(D,[["render",O]]),I={props:{coupon:{type:Object,default(){return{}}},isNew:{type:Boolean,default:!1}},data(){return{modal:"",tempCoupon:{},due_date:""}},methods:{showModal(){this.modal.show()},hideModal(){this.modal.hide()}},mounted(){this.modal=new $(this.$refs.modal),console.log(this.coupon),console.log(this.isNew)},watch:{coupon(){this.tempCoupon=this.coupon;const t=new Date(this.tempCoupon.due_date*1e3).toISOString().split("T");[this.due_date]=t},due_date(){this.tempCoupon.due_date=Math.floor(new Date(this.due_date)/1e3)}}},R={class:"modal fade",id:"couponModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"modal"},S={class:"modal-dialog",role:"document"},j={class:"modal-content"},F={class:"modal-header"},H={class:"modal-title",id:"exampleModalLabel"},q={key:0},G={key:1},z=o("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),J={class:"modal-body"},K={class:"mb-3"},Q=o("label",{for:"title"},"標題",-1),W={class:"mb-3"},X=o("label",{for:"coupon_code"},"優惠碼",-1),Y={class:"mb-3"},Z=o("label",{for:"due_date"},"到期日",-1),oo={class:"mb-3"},eo=o("label",{for:"price"},"折扣百分比",-1),to={class:"mb-3"},so={class:"form-check"},no=o("label",{class:"form-check-label",for:"is_enabled"}," 是否啟用 ",-1),lo={class:"modal-footer"},io=o("button",{type:"button",class:"btn btn-outline-primary","data-bs-dismiss":"modal"},"關閉",-1);function ao(t,e,i,p,s,a){return l(),d("div",R,[o("div",S,[o("div",j,[o("div",F,[o("h5",H,[i.isNew?(l(),d("span",q,"新增優惠卷")):(l(),d("span",G,"編輯優惠卷"))]),z]),o("div",J,[o("div",K,[Q,c(o("input",{type:"text",class:"form-control",id:"title","onUpdate:modelValue":e[0]||(e[0]=n=>s.tempCoupon.title=n),placeholder:"請輸入標題"},null,512),[[m,s.tempCoupon.title]])]),o("div",W,[X,c(o("input",{type:"text",class:"form-control",id:"coupon_code","onUpdate:modelValue":e[1]||(e[1]=n=>s.tempCoupon.code=n),placeholder:"請輸入優惠碼"},null,512),[[m,s.tempCoupon.code]])]),o("div",Y,[Z,c(o("input",{type:"date",class:"form-control",id:"due_date","onUpdate:modelValue":e[2]||(e[2]=n=>s.due_date=n)},null,512),[[m,s.due_date]])]),o("div",oo,[eo,c(o("input",{type:"number",class:"form-control",id:"price",min:"0","onUpdate:modelValue":e[3]||(e[3]=n=>s.tempCoupon.percent=n),placeholder:"請輸入折扣百分比"},null,512),[[m,s.tempCoupon.percent,void 0,{number:!0}]])]),o("div",to,[o("div",so,[c(o("input",{class:"form-check-input",type:"checkbox","true-value":1,"false-value":0,"onUpdate:modelValue":e[4]||(e[4]=n=>s.tempCoupon.is_enabled=n),id:"is_enabled"},null,512),[[w,s.tempCoupon.is_enabled]]),no])])]),o("div",lo,[io,o("button",{type:"button",class:"btn btn-primary",onClick:e[5]||(e[5]=n=>t.$emit("update-coupon",s.tempCoupon))},r(i.isNew?"新增優惠卷":"更新優惠券"),1)])])])],512)}const uo=b(I,[["render",ao]]),{VITE_APP_URL:_,VITE_APP_PATH:h}={VITE_APP_URL:"https://vue3-course-api.hexschool.io/",VITE_APP_PATH:"jiangs2023",BASE_URL:"/vue_week_07/",MODE:"production",DEV:!1,PROD:!0},po={data(){return{coupons:{},tempCoupon:{title:"",is_enabled:0,percent:100,code:""},isNew:!1}},components:{AdminCouponModal:uo,AdminCouponDelModal:B},methods:{getCoupons(){this.$http(`${_}api/${h}/admin/coupons`).then(t=>{console.log(t),this.coupons=t.data.coupons})},openCouponModal(t,e){this.isNew=t,console.log(t),this.isNew?(this.tempCoupon={due_date:new Date().getTime()/1e3},console.log(this.tempCoupon)):(this.tempCoupon={...e},console.log(this.tempCoupon)),this.$refs.couponModal.showModal()},updateCoupon(t){let e=`${_}api/${h}/admin/coupon`,i="post",p=t;console.log(t),this.isNew||(e=`${_}api/${h}/admin/coupon/${this.tempCoupon.id}`,i="put",p=this.tempCoupon,console.log(p)),this.$http[i](e,{data:p}).then(s=>{console.log(s),this.getCoupons(),this.$refs.couponModal.hideModal()})},openCouponDelModal(t){this.tempCoupon={...t},this.$refs.delCouponModal.showModal()},delCoupon(){this.$http.delete(`${_}api/${h}/admin/coupon/${this.tempCoupon.id}`).then(t=>{console.log(t),this.$refs.delCouponModal.hideModal(),this.getCoupons()})}},mounted(){this.getCoupons()}},co={class:"text-end mt-4"},ro={class:"table mt-4"},mo=o("thead",null,[o("tr",null,[o("th",null,"名稱"),o("th",null,"折扣百分比"),o("th",null,"到期日"),o("th",null,"是否啟用"),o("th",null,"編輯")])],-1),_o={key:0,class:"text-success"},ho={key:1,class:"text-muted"},bo=["onClick"],Co=o("i",{class:"bi bi-pencil-square"},null,-1),fo=[Co],Mo=["onClick"],$o=o("i",{class:"bi bi-trash3-fill"},null,-1),vo=[$o];function yo(t,e,i,p,s,a){const n=f("AdminCouponModal"),v=f("AdminCouponDelModal");return l(),d("div",null,[o("div",co,[o("button",{class:"btn btn-primary",type:"button",onClick:e[0]||(e[0]=u=>a.openCouponModal(!0))}," 建立新的優惠券 ")]),o("table",ro,[mo,o("tbody",null,[(l(!0),d(k,null,x(s.coupons,(u,y)=>(l(),d("tr",{key:y},[o("td",null,r(u.title),1),o("td",null,r(u.percent)+"%",1),o("td",null,r(u.due_date),1),o("td",null,[u.is_enabled===1?(l(),d("span",_o,"啟用")):(l(),d("span",ho,"未啟用"))]),o("td",null,[o("button",{class:"btn btn-outline-primary btn-sm me-1 mb-1",onClick:g=>a.openCouponModal(!1,u)},fo,8,bo),o("button",{class:"btn btn-outline-danger btn-sm me-1 mb-1",onClick:g=>a.openCouponDelModal(u)},vo,8,Mo)])]))),128))])]),M(n,{ref:"couponModal",coupon:s.tempCoupon,"is-new":s.isNew,onUpdateCoupon:a.updateCoupon},null,8,["coupon","is-new","onUpdateCoupon"]),M(v,{ref:"delCouponModal",coupon:s.tempCoupon,onDelCoupon:a.delCoupon},null,8,["coupon","onDelCoupon"])])}const xo=b(po,[["render",yo]]);export{xo as default};
